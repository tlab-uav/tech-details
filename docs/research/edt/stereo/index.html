<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/tech-details/blog/rss.xml" title="117411 TSL UAV Tech Details Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/tech-details/blog/atom.xml" title="117411 TSL UAV Tech Details Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous"><title data-react-helmet="true">stereo.cpp | 117411 TSL UAV Tech Details</title><meta data-react-helmet="true" property="og:url" content="https://tlab-uav.github.io//tech-details/docs/research/edt/stereo/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="stereo.cpp | 117411 TSL UAV Tech Details"><meta data-react-helmet="true" name="description" content="implement a class StereoUpdater with param"><meta data-react-helmet="true" property="og:description" content="implement a class StereoUpdater with param"><link data-react-helmet="true" rel="shortcut icon" href="/tech-details/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://tlab-uav.github.io//tech-details/docs/research/edt/stereo/"><link data-react-helmet="true" rel="alternate" href="https://tlab-uav.github.io//tech-details/docs/research/edt/stereo/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://tlab-uav.github.io//tech-details/docs/research/edt/stereo/" hreflang="x-default"><link rel="stylesheet" href="/tech-details/assets/css/styles.032a5ccc.css">
<link rel="preload" href="/tech-details/assets/js/runtime~main.73297725.js" as="script">
<link rel="preload" href="/tech-details/assets/js/main.307f6eb9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/tech-details/"><img src="/tech-details/img/android-chrome-192x192.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/tech-details/img/android-chrome-192x192.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">TSL Tech Details</b></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/tech-details/docs/hardware/jetson-tx2/flash-existing-image/">Hardware</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/hardware/jetson-tx2/flash-existing-image/">Jetson TX2</a></li><li><a class="dropdown__link" href="/tech-details/docs/hardware/jetson-xavier-nx/getting-started/">Jetson Xavier NX</a></li><li><a class="dropdown__link" href="/tech-details/docs/hardware/cameras/tiscamera-install/">Cameras</a></li><li><a class="dropdown__link" href="/tech-details/docs/hardware/px4-firmware/px4-overview/">PX4 Firmware</a></li><li><a class="dropdown__link" href="/tech-details/docs/hardware/UAV-Platform/Multirotor-overview/">UAV Platform</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/tech-details/docs/systems/vicon/">Systems</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/systems/ros-coordinate-systems/">ROS Coordinate Systems</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/unity-simulator/">Simulations</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/multi-agent-px4-sitl/">Multi-agent PX4 SITL</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/vicon/">Vicon</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/pixhawk/getting-started/">Pixhawk Platform</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/pixhawk_v1/pixhawk/">Past Platforms : pixhawk v1</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/SAFMC/">SAFMC Drone Buildup</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/Crazyflie/">Crazyflie</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/tech-details/docs/linux/getting-started/gnome-shell-extensions/">Linux</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/linux/getting-started/overview/">Getting Started</a></li><li><a class="dropdown__link" href="/tech-details/docs/linux/packages/file-systems/">Software Packages</a></li><li><a class="dropdown__link" href="/tech-details/docs/linux/ros/using-catkin-build/">ROS</a></li><li><a class="dropdown__link" href="/tech-details/docs/linux/kernel/grub-default-kernel/">Drivers &amp; Kernel</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/tech-details/docs/productivity/git/git/">Productivity</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/productivity/git/git/">Git Version Control</a></li><li><a class="dropdown__link" href="/tech-details/docs/productivity/cmake_debug/cmake/">CMake and Debugging</a></li><li><a class="dropdown__link" href="/tech-details/docs/productivity/uiux/pangolin/">UI/UX Tools</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/tech-details/docs/research/flight-data/flight-data-analysis/">Research</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/research/flight-data/flight-data-analysis/">Flight Data</a></li><li><a class="dropdown__link" href="/tech-details/docs/research/calibration/getting-started/">Sensor Calibration</a></li><li><a class="dropdown__link" href="/tech-details/docs/research/collision-avoidance/overview-problems/">Collision Avoidance</a></li><li><a class="dropdown__link" href="/tech-details/docs/research/vio/basalt-overview/">VIO</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/tech-details/docs/research/edt/edt-overview/">EDT</a></li></ul></div><a class="navbar__item navbar__link" href="/tech-details/docs/examples/doc0/">Examples (To Edit)</a><a class="navbar__item navbar__link" href="/tech-details/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tlab-uav/tech-details" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/tech-details/"><img src="/tech-details/img/android-chrome-192x192.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/tech-details/img/android-chrome-192x192.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">TSL Tech Details</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/tech-details/docs/hardware/jetson-tx2/flash-existing-image/">Hardware</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/jetson-tx2/flash-existing-image/">Jetson TX2</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/jetson-xavier-nx/getting-started/">Jetson Xavier NX</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/cameras/tiscamera-install/">Cameras</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/px4-firmware/px4-overview/">PX4 Firmware</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/UAV-Platform/Multirotor-overview/">UAV Platform</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/tech-details/docs/systems/vicon/">Systems</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/ros-coordinate-systems/">ROS Coordinate Systems</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/unity-simulator/">Simulations</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/multi-agent-px4-sitl/">Multi-agent PX4 SITL</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/vicon/">Vicon</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/pixhawk/getting-started/">Pixhawk Platform</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/pixhawk_v1/pixhawk/">Past Platforms : pixhawk v1</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/SAFMC/">SAFMC Drone Buildup</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/Crazyflie/">Crazyflie</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/tech-details/docs/linux/getting-started/gnome-shell-extensions/">Linux</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/linux/getting-started/overview/">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/linux/packages/file-systems/">Software Packages</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/linux/ros/using-catkin-build/">ROS</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/linux/kernel/grub-default-kernel/">Drivers &amp; Kernel</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/tech-details/docs/productivity/git/git/">Productivity</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/productivity/git/git/">Git Version Control</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/productivity/cmake_debug/cmake/">CMake and Debugging</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/productivity/uiux/pangolin/">UI/UX Tools</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a aria-current="page" class="menu__link menu__link--sublist navbar__link--active" role="button" href="/tech-details/docs/research/flight-data/flight-data-analysis/">Research</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/flight-data/flight-data-analysis/">Flight Data</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/calibration/getting-started/">Sensor Calibration</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/collision-avoidance/overview-problems/">Collision Avoidance</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/vio/basalt-overview/">VIO</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/tech-details/docs/research/edt/edt-overview/">EDT</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/examples/doc0/">Examples (To Edit)</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/blog/">Blog</a></li><li class="menu__list-item"><a href="https://github.com/tlab-uav/tech-details" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Flight Data</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/flight-data/flight-data-analysis/">Flight Data Analysis</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Camera Calibration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/calibration/getting-started/">Getting Started with Kalibr</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/calibration/calibration-target-params/">Calibration Targets &amp; Params</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/calibration/kalibr-result-conventions/">Kalibr Result Conventions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/calibration/calibration-procedures/">Calibration Procedures</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/calibration/verify-by-kalibr-validator/">Verify by Kalibr Validator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/calibration/verify-by-triangulation-depth/">Verify by Triangulation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/calibration/Calibration results/Calibration results/">Calibration results</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Collision Avoidance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/collision-avoidance/overview-problems/">Overview &amp; Current Problems</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/collision-avoidance/design-choices/">Design Choices</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/collision-avoidance/controls/">CA Controls</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">VIO</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/vio/basalt-overview/">Framework Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/vio/basalt-tuning/">System Tuning &amp; Configs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/vio/basalt-backend/">Basalt Backend (VioEstimator)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/vio/basalt-frontend/">Basalt Frontend (Optical Flow)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/vio/basalt-tests/">System Level Tests</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">EDT</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tech-details/docs/research/edt/edt-overview/">Framework Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tech-details/docs/research/edt/MapUpdater/">Map Updater</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/tech-details/docs/research/edt/stereo/">stereo</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">MSCKF_VIO Loop Closure</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/research/msckf_vio/loop_closure/">loop_closure Overview</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">stereo.cpp</h1></header><p>implement a class <code>StereoUpdater</code> with param </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">StereoUpdater</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">StereoUpdater</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LinDistMap </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">dmap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DevMap </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">dev_map</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                StereoParams p</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">MapUpdater</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dmap</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">dev_map</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_sp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">allocMem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">_sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cols</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>allocate, free, reallocate memory for depth and confidence on device, <code>_D_depth</code>, <code>_D_confi_map</code></p><p>implement a function <code>makeStereoPt</code>: (1) get the current camera pose (call <code>updateProjection(trans)</code> in <code>MapUpdater.cpp</code>); (2) copy depthmap and confidence into device (although confidence not used in linear distance map optimization currently); (3) call the GPU function to construct probablity map in kernel/stereo_kernel.cu</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Get the current camera pose</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">updateProjection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">trans</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Copty the depthmap, etc into the device</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">topic2Dmem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">depthPoint</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">confidence_ptr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Start the GPU kernel to construct the probability map</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    stereo</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">stereoKernelWrapper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_sp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">_mp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">_D_depth</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">_D_confi_map</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">_dev_map</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><header><h1 class="h1Heading_27L5">kernel/stereo_kernel.cu</h1></header><p>in function <code>void stereoKernelWrapper(const StereoParams &amp;sp, const ProjParams &amp;mp, float *d_depth, float* d_confi_map, DevMap *dev_map)</code> call the GPU kernel function <code>__global__ void stereoMapSingleUpdater(StereoParams sp, ProjParams mp,float *d_depth, DevMap dev_map, DevGeo::coord shift)</code>, blks=range of z, threads=range of y</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> gridSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dev_map</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">updateRange</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> blkSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dev_map</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">updateRange</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// calculate the shift</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    DevGeo</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">coord shift </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dev_map</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">pos2coord</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">center</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    shift</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> dev_map</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">updateRange</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    shift</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> dev_map</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">updateRange</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    shift</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">z </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> dev_map</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">updateRange</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">z</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    stereoMapSingleUpdater</span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">gridSize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">blkSize</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">mp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">d_depth</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">dev_map</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">shift</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>in GPU kernel function <code>stereoMapSingleUpdater</code>, in each thread, loop all the range of x, convert grid coordinate to global position (call function <code>coord2pos</code> in <code>kernel/helper_mapop.cuh</code>), then transform to body frame, finally project into pixel through calling the function <code>void global2project(const DevGeo::coord &amp;grid_crd,const ProjParams &amp;mp, const DevMap &amp;dev_map, const StereoParams &amp;sp, int2 &amp;pix, float &amp;depth)</code>, global frame using NWU. in  <code>coord2pos</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> dev_map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">updateRange</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> shift</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">global2project</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">mp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">dev_map</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pix</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">depth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>do nothing for too large or too small depth and projected pixels out of image range. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">depth </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> depth </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">4.5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pix</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> pix</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cols </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> pix</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> pix</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rows </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> pix</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">crop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here, compare two values, depth and img_depth. depth is the existing grid after projection, img_depth is the sensor measured depth in current frame. if grid is in front of the sensor measured depth, it should be not occupied (value = 0), then send to low pass filter to update. if grid is far behind the sensor measured depth, it cannot be seen by sensor, do nothing. if the grid is near the sensor measured depth, it should be occupied (value = 1), send to low pass filter to update. the low pass filter is a function <code>lowpassOccupancy</code> in <code>kernel/helper_mapop.cuh</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">        img_depth</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">d_depth</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cols</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pix</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">pix</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">isnan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">img_depth</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> img_depth </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.21</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">depth </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> img_depth </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.21</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">lowpassOccupancy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dev_map</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">depth </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> img_depth </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.21</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// not seen do nothing</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">lowpassOccupancy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dev_map</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><header><h1 class="h1Heading_27L5">kernel/helper_mapop.cuh</h1></header><p>low pass filter</p><p><code>__device__ __forceinline__ void lowpassOccupancy(const DevGeo::coord &amp;c, float val, float beta,const DevMap &amp;dev_map)</code></p><p>global position to grid map coordinate</p><p><code>__device__ __forceinline__ DevGeo::coord pos2coord(const DevGeo::pos &amp;p,const DevGeo::pos &amp;origin, const float &amp;gridstep)</code></p><p>grid map coordinate to global position</p><p><code>__device__ __forceinline__ DevGeo::pos coord2pos(const DevGeo::coord &amp; c,const DevGeo::pos &amp;origin, const float &amp;gridstep)</code></p><header><h1 class="h1Heading_27L5">dsstereo_kernel.cu</h1></header><p>difference with <code>stereo_kernel.cu</code>
in the function <code>global2project</code>, the projection of 3D point to image pixel using the double sphere fisheye camera model; add params, <code>d_min</code>, <code>d_max</code>, <code>d_thre</code>, <code>sweep_mode</code></p></div><footer class="row docusaurus-mt-lg"><div class="col"></div><div class="col lastUpdated_3DPF">Last updated on <b><time datetime="2021-08-14T16:02:32.000Z">8/14/2021</time></b></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/tech-details/docs/research/edt/MapUpdater/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Map Updater</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/tech-details/docs/research/msckf_vio/loop_closure/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">loop_closure Overview Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/tech-details/docs/doc1/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/tech-details/docs/doc2/">Second Doc</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/tech-details/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/tlab-uav/tech-details" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 TSL. Built with Docusaurus.</div></div></div></footer></div>
<script src="/tech-details/assets/js/runtime~main.73297725.js"></script>
<script src="/tech-details/assets/js/main.307f6eb9.js"></script>
</body>
</html>