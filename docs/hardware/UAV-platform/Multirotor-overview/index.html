<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/tech-details/blog/rss.xml" title="117411 TSL UAV Tech Details Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/tech-details/blog/atom.xml" title="117411 TSL UAV Tech Details Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous"><title data-react-helmet="true">Overview | 117411 TSL UAV Tech Details</title><meta data-react-helmet="true" property="og:url" content="https://tlab-uav.github.io//tech-details/docs/hardware/UAV-platform/Multirotor-overview/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Overview | 117411 TSL UAV Tech Details"><meta data-react-helmet="true" name="description" content="Multirotor is a class of rotor craft that our group uses for control, perception and swarm algorithm development and testing."><meta data-react-helmet="true" property="og:description" content="Multirotor is a class of rotor craft that our group uses for control, perception and swarm algorithm development and testing."><link data-react-helmet="true" rel="shortcut icon" href="/tech-details/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://tlab-uav.github.io//tech-details/docs/hardware/UAV-platform/Multirotor-overview/"><link data-react-helmet="true" rel="alternate" href="https://tlab-uav.github.io//tech-details/docs/hardware/UAV-platform/Multirotor-overview/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://tlab-uav.github.io//tech-details/docs/hardware/UAV-platform/Multirotor-overview/" hreflang="x-default"><link rel="stylesheet" href="/tech-details/assets/css/styles.032a5ccc.css">
<link rel="preload" href="/tech-details/assets/js/runtime~main.a0b825b1.js" as="script">
<link rel="preload" href="/tech-details/assets/js/main.7a91feed.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/tech-details/"><img src="/tech-details/img/android-chrome-192x192.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/tech-details/img/android-chrome-192x192.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">TSL Tech Details</b></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/tech-details/docs/hardware/jetson-tx2/flash-existing-image/">Hardware</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/hardware/jetson-tx2/flash-existing-image/">Jetson TX2</a></li><li><a class="dropdown__link" href="/tech-details/docs/hardware/jetson-xavier-nx/getting-started/">Jetson Xavier NX</a></li><li><a class="dropdown__link" href="/tech-details/docs/hardware/cameras/tiscamera-install/">Cameras</a></li><li><a class="dropdown__link" href="/tech-details/docs/hardware/px4-firmware/px4-overview/">PX4 Firmware</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/tech-details/docs/hardware/UAV-Platform/Multirotor-overview/">UAV Platform</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/tech-details/docs/systems/vicon/">Systems</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/systems/ros-coordinate-systems/">ROS Coordinate Systems</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/unity-simulator/">Simulations</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/vicon/">Vicon</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/pixhawk/getting-started/">Pixhawk Platform</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/pixhawk_v1/pixhawk/">Past Platforms : pixhawk v1</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/SAFMC/">SAFMC Drone Buildup</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/Crazyflie/">Crazyflie</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/tech-details/docs/linux/getting-started/gnome-shell-extensions/">Linux</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/linux/getting-started/overview/">Getting Started</a></li><li><a class="dropdown__link" href="/tech-details/docs/linux/packages/file-systems/">Software Packages</a></li><li><a class="dropdown__link" href="/tech-details/docs/linux/ros/using-catkin-build/">ROS</a></li><li><a class="dropdown__link" href="/tech-details/docs/linux/kernel/grub-default-kernel/">Drivers &amp; Kernel</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/tech-details/docs/productivity/git/git/">Productivity</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/productivity/git/git/">Git Version Control</a></li><li><a class="dropdown__link" href="/tech-details/docs/productivity/cmake_debug/cmake/">CMake and Debugging</a></li><li><a class="dropdown__link" href="/tech-details/docs/productivity/uiux/pangolin/">UI/UX Tools</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/tech-details/docs/research/flight-data/flight-data-analysis/">Research</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/research/flight-data/flight-data-analysis/">Flight Data</a></li><li><a class="dropdown__link" href="/tech-details/docs/research/calibration/getting-started/">Sensor Calibration</a></li><li><a class="dropdown__link" href="/tech-details/docs/research/collision-avoidance/overview-problems/">Collision Avoidance</a></li><li><a class="dropdown__link" href="/tech-details/docs/research/vio/basalt-overview/">VIO</a></li><li><a class="dropdown__link" href="/tech-details/docs/research/edt/edt-overview/">EDT</a></li></ul></div><a class="navbar__item navbar__link" href="/tech-details/docs/examples/doc0/">Examples (To Edit)</a><a class="navbar__item navbar__link" href="/tech-details/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tlab-uav/tech-details" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/tech-details/"><img src="/tech-details/img/android-chrome-192x192.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/tech-details/img/android-chrome-192x192.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">TSL Tech Details</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a aria-current="page" class="menu__link menu__link--sublist navbar__link--active" role="button" href="/tech-details/docs/hardware/jetson-tx2/flash-existing-image/">Hardware</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/jetson-tx2/flash-existing-image/">Jetson TX2</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/jetson-xavier-nx/getting-started/">Jetson Xavier NX</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/cameras/tiscamera-install/">Cameras</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/px4-firmware/px4-overview/">PX4 Firmware</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/tech-details/docs/hardware/UAV-Platform/Multirotor-overview/">UAV Platform</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/tech-details/docs/systems/vicon/">Systems</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/ros-coordinate-systems/">ROS Coordinate Systems</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/unity-simulator/">Simulations</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/vicon/">Vicon</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/pixhawk/getting-started/">Pixhawk Platform</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/pixhawk_v1/pixhawk/">Past Platforms : pixhawk v1</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/SAFMC/">SAFMC Drone Buildup</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/Crazyflie/">Crazyflie</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/tech-details/docs/linux/getting-started/gnome-shell-extensions/">Linux</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/linux/getting-started/overview/">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/linux/packages/file-systems/">Software Packages</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/linux/ros/using-catkin-build/">ROS</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/linux/kernel/grub-default-kernel/">Drivers &amp; Kernel</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/tech-details/docs/productivity/git/git/">Productivity</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/productivity/git/git/">Git Version Control</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/productivity/cmake_debug/cmake/">CMake and Debugging</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/productivity/uiux/pangolin/">UI/UX Tools</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/tech-details/docs/research/flight-data/flight-data-analysis/">Research</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/flight-data/flight-data-analysis/">Flight Data</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/calibration/getting-started/">Sensor Calibration</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/collision-avoidance/overview-problems/">Collision Avoidance</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/vio/basalt-overview/">VIO</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/edt/edt-overview/">EDT</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/examples/doc0/">Examples (To Edit)</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/blog/">Blog</a></li><li class="menu__list-item"><a href="https://github.com/tlab-uav/tech-details" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">UAV platform</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/tech-details/docs/hardware/UAV-platform/Multirotor-overview/">Multirotor Overview</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">Overview</h1></header><p>Multirotor is a class of rotor craft that our group uses for control, perception and swarm algorithm development and testing.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="platform"></a>Platform<a class="hash-link" href="#platform" title="Direct link to heading">#</a></h2><ol><li>Solder ESC GND pads to AUAV Power Module </li></ol><p><img src="/tech-details/assets/images/YJ1-4440f419d3078ef84cbb514785ca8d73.jpg"></p><ol start="2"><li>Place the flight control board on the layer above with buzzer and safety switch connected</li></ol><p><img src="/tech-details/assets/images/YJ2-49ea38aadc2f3a5bf2f60506a720f31c.jpg"></p><ol start="3"><li>Connect ESC servo to flight control board </li></ol><blockquote><p>Connect ESC servo to <strong>MAIN OUT</strong> (<em>not AUX OUT</em>) according to the labelled numbers </p></blockquote><ol start="4"><li>Connect receiver to RC on flight control board</li></ol><p><img src="/tech-details/assets/images/YJ3-53c5d64cd3fee87da2924cddbda98da9.jpg"></p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Always keep the cables neatly arranged and components fixed in place. It is recommended to use cable ties and double-sided tape to help with the practice. Try not to bundle the cable near the propellers for safety purposes.</p></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Always check the polarity.</p></div></div><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="qgroundcontrol"></a>QGroundControl<a class="hash-link" href="#qgroundcontrol" title="Direct link to heading">#</a></h2><ol><li>Download QGroundControl on <a href="https://docs.qgroundcontrol.com/master/en/getting_started/download_and_install.html" target="_blank" rel="noopener noreferrer">DroneCode</a> (Code is available on <a href="https://github.com/mavlink/qgroundcontrol" target="_blank" rel="noopener noreferrer">GitHub</a>)</li><li>Run <em>./QGroundControlAppImage</em> on terminal</li><li>Connect the flight control board to computer via USB port</li><li>Update the firmware</li><li>Select correct airframe</li><li>Connect the vehicle to battery and calibrate ESC PWM Minimum and Maximum</li><li>Calibrate sensors</li><li>Set up and calibrate radio (controller)</li></ol><blockquote><p>In order to connect the controller to receiver, press the LINK/MODE on receiver until the red light start blinking and then turn on the controller. When the light turns green, the connection is done.</p></blockquote><ol start="9"><li>Set up flight mode</li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>More detailed information can be found on <a href="https://docs.qgroundcontrol.com/master/en/SetupView/SetupView.html" target="_blank" rel="noopener noreferrer">Vehicle Setup</a>.</p></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Safety switch: Double blinking suggests that vehicle can be armed while single blinking suggest that vehicle is not allowed to be armed.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tuning"></a><strong>Tuning</strong><a class="hash-link" href="#tuning" title="Direct link to heading">#</a></h3><p>Tuning is required when creating a <strong>new airframe type</strong> or significantly modifying an existing supported frame. Generally if you&#x27;re using a supported configuration (e.g. using an airframe in QGroundControl &gt; Airframe) the default tuning should be acceptable (particularly for larger frames).</p><p>Reference from <a href="https://docs.px4.io/master/en/config_mc/pid_tuning_guide_multicopter.html" target="_blank" rel="noopener noreferrer">PX4UserGuide</a> and <a href="https://madennis.gitbooks.io/px4user/content/en/advanced_config/pid_tuning_guide_multicopter.html" target="_blank" rel="noopener noreferrer">dronecode</a>.</p><blockquote><p>All tuning should be performed in the manual Stabilized flight mode.</p></blockquote><p>Go into <strong>settings</strong> &gt; <strong>tuning</strong> &gt; click on the <strong>advance</strong> at the topright corner</p><p><img src="/tech-details/assets/images/PID2-9eff09b7709fb45085b5253ba4c86623.png"></p><p><strong>Mavlink Inspector</strong> could also be used to monitor the response from the drone. The response and the command graph should be rather close to one another for a good response from the drone. Check for overshoot or any sluggish response from the drone by feel or looking at the graph. </p><p><img src="/tech-details/assets/images/PID1-c25f0b0d10713a73815b77230be1186a.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-1-preparation"></a><strong>Step 1: Preparation</strong><a class="hash-link" href="#step-1-preparation" title="Direct link to heading">#</a></h3><p>First of all set all parameters to initial values:</p><ol><li>Set all MC<em>XXX_P to zero </em>(ROLL, PITCH, YAW)_</li><li>Set all MC_XXXRATE_P, MC_XXXRATE_I, MC_XXXRATE_D to <strong>zero</strong>, except MC_ROLLRATE_P and MC_PITCHRATE_P</li><li>Set MC_ROLLRATE_P and MC_PITCHRATE_P to a small value, e.g. 0.02</li><li>Set MC_YAW_FF to 0.5</li></ol><blockquote><p>All gains should be increased slowly, about 20%-30% per iteration, 10% for fine tuning. Large gains may cause very dangerous oscillations.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-2-stabilize-roll-and-pitch-rates"></a><strong>Step 2: Stabilize Roll and Pitch Rates</strong><a class="hash-link" href="#step-2-stabilize-roll-and-pitch-rates" title="Direct link to heading">#</a></h3><p><strong>P Gain Tuning</strong></p><p>Parameters: MC_ROLLRATE_P, MC_PITCHRATE_P.</p><p>Tilt it in roll or pitch direction, and observe the response. If it oscillates, tune down RATE_P. Once the control response is slow but correct, increase RATE_P until it starts to oscillate. Cut back RATE_P until it does only mildly oscillate or not oscillate any more (about 10% cutback), just over-shoots. Typical value is around 0.1.</p><p><strong>D Gain Tuning</strong></p><p>Parameters: MC_ROLLRATE_D, MC_PITCHRATE_D.</p><p>Assuming the gains are in a state where the multi rotor oscillated and RATE_P was slightly reduced. Slowly increase RATE_D, starting from 0.01. Increase RATE_D to stop the last bit of oscillation. If the motors become twitchy, the RATE_D is too large, cut it back. By playing with the magnitudes of RATE_P and RATE_D the response can be fine-tuned. Typical value is around 0.01â€¦0.02.</p><p><strong>I Gain Tuning</strong></p><p>If the roll and pitch rates never reach the setpoint but have an offset, add MC_ROLLRATE_I and MC_PITCHRATE_I gains, starting at 5-10% of the MC_ROLLRATE_P gain value.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-3-stabilize-roll-and-pitch-angles"></a><strong>Step 3: Stabilize Roll and Pitch Angles</strong><a class="hash-link" href="#step-3-stabilize-roll-and-pitch-angles" title="Direct link to heading">#</a></h3><p><strong>P Gain Tuning</strong></p><p>Parameters: MC_ROLL_P, MC_PITCH_P.</p><p>Set MC_ROLL_P and MC_PITCH_P to a small value, e.g. 3
Tilt it in roll or pitch direction, and observe the response. If it oscillates, tune down P. Once the control response is slow but correct, increase P until it starts to oscillate. Optimal response is some overshoot (~10-20%). After getting stable response fine tune RATE_P, RATE_D again.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-4-stabilize-yaw-rate"></a><strong>Step 4: Stabilize Yaw Rate</strong><a class="hash-link" href="#step-4-stabilize-yaw-rate" title="Direct link to heading">#</a></h3><p><strong>P Gain Tuning</strong></p><p>Parameters: MC_YAWRATE_P.</p><p>Set MC_YAWRATE_P to small value, e.g. 0.1</p><p>If it oscillates or becomes twitchy, tune down RATE_P. If response is very large even on small movements (full throttle spinning vs idle spinning propellers) reduce RATE_P. Typical value is around 0.2â€¦0.3.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-5-stabilize-yaw-angle"></a><strong>Step 5: Stabilize Yaw Angle</strong><a class="hash-link" href="#step-5-stabilize-yaw-angle" title="Direct link to heading">#</a></h3><p><strong>P Gain Tuning</strong></p><p>Parameters: MC_YAW_P.</p><p>Set MC_YAW_P to a low value, e.g. 1
If it oscillates, tune down P. Once the control response is slow but correct, increase P until the response is firm, but it does not oscillate. Typical value is around 2â€¦3.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pixhawk"></a>Pixhawk<a class="hash-link" href="#pixhawk" title="Direct link to heading">#</a></h2><p>Check out the <a href="https://dev.px4.io/master/en/companion_computer/pixhawk_companion.html" target="_blank" rel="noopener noreferrer">website</a> to set up the <code>TELEM2</code> port for companion computer.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="nvidia-jetson-xavier-nx"></a>Nvidia Jetson Xavier NX<a class="hash-link" href="#nvidia-jetson-xavier-nx" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-set-up-jetson-xavier-nx-developer-kit"></a>1. Set up <a href="https://developer.nvidia.com/embedded/learn/get-started-jetson-xavier-nx-devkit#write" target="_blank" rel="noopener noreferrer">Jetson Xavier NX Developer Kit</a><a class="hash-link" href="#1-set-up-jetson-xavier-nx-developer-kit" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-install-software-with-sdk-manager"></a>2. Install software with SDK Manager<a class="hash-link" href="#2-install-software-with-sdk-manager" title="Direct link to heading">#</a></h3><p>2.1. Download <a href="https://developer.nvidia.com/nvidia-sdk-manager" target="_blank" rel="noopener noreferrer">SDK Manager</a> on a developer host machine</p><p>2.2. Connect Xavier to the developer host machine via micro USB port</p><p>2.3. Follow the <a href="https://docs.nvidia.com/sdk-manager/install-with-sdkm-jetson/index.html" target="_blank" rel="noopener noreferrer">instructions</a> </p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Untick Jetson OS at Step 3</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-install-ros-melodic"></a>3. Install <a href="http://wiki.ros.org/melodic/Installation/Ubuntu" target="_blank" rel="noopener noreferrer">ROS Melodic</a><a class="hash-link" href="#3-install-ros-melodic" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-follow-the-source-installation-instructions-at-dronecode-to-compile-mavros"></a>4. Follow the <em>source installation instructions</em> at <a href="https://dev.px4.io/master/en/ros/mavros_installation.html" target="_blank" rel="noopener noreferrer">DroneCode</a> to compile <a href="https://github.com/mavlink/mavros/blob/master/mavros/README.md" target="_blank" rel="noopener noreferrer">MAVROS</a><a class="hash-link" href="#4-follow-the-source-installation-instructions-at-dronecode-to-compile-mavros" title="Direct link to heading">#</a></h3><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Add the following lines into .bashrc</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo apt install nano</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ nano .bashrc</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># Lines to be added</span></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/ros/melodic/setup.bash</span></span><span class="token-line" style="color:#393A34"><span class="token plain">source /home/yt/catkin_ws/devel/setup.bash</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-check-serial-port-txrx-using-loopback-test"></a>5. Check serial port (TX/RX) using <a href="https://amitasinghchauhan.medium.com/serial-port-debugging-101-loopback-test-4a7e40da9055" target="_blank" rel="noopener noreferrer">loopback test</a><a class="hash-link" href="#5-check-serial-port-txrx-using-loopback-test" title="Direct link to heading">#</a></h3><p>5.1. Connect the TX and RX port using one cable in order to perform loopback test</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>The pin configuration of Jetson Xavier NX Developer Kit can be found <a href="https://www.jetsonhacks.com/nvidia-jetson-xavier-nx-gpio-header-pinout/" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div><p>5.2. Set up Minicom</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo apt-get install minicom</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ minicom</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>5.3. Open up Minicom and perform loopback test</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo minicom -D /dev/ttyTHS0 </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Press Ctrl A-Z </li><li>Press O to configure minicom </li><li>Select serial port setup</li><li>Change serial device </li></ul><p>Or </p><ul><li>Open the minicom in terminal using different tty*</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>List of tty* can be found by typing the following code in terminal</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ ls /dev/tty*</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><blockquote><p>To verify the TX/RX ports, make sure the content you type in shows on the terminal.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="6-modify-the-line-shown-below-in-px4launch-file"></a>6. Modify the line shown below in <code>px4.launch</code> file<a class="hash-link" href="#6-modify-the-line-shown-below-in-px4launch-file" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># path: ~/catkin_ws/src/mavros/mavros/launch</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># line to be modified: </span></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;arg name =&quot;fcu_url&quot; default=&quot;/dev/ttyTHS0:921600&quot;&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Set tty to the tty verified in previous step (For example: <code>ttyASM0</code> -&gt; <code>ttyTHS0</code>)</li><li>Change the baudrate (the number behind tty) to the baudrate of <code>TELEM2</code></li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Check the baudrate of <code>TELEM2</code> on QGroundControl by searching the parameter <code>SER_TEL2_BAUD</code>.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="7-check-the-connection-between-px4-and-jetson-xavier"></a>7. Check the connection between PX4 and Jetson Xavier<a class="hash-link" href="#7-check-the-connection-between-px4-and-jetson-xavier" title="Direct link to heading">#</a></h3><p>7.1. Connect RX, TX and GND pin on Jetson Xavier to <code>TELEM2</code> on PX4</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Pin configuration of <code>TELEM2</code> on PX4 (from left to right) is 5V, RX, TX, CTS, RTS, GND.</p></div></div><p>7.2. Boot up PX4 and check if anything shows up on the Minicom on Jetson Xavier</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="8-run-px4launch-file"></a>8. Run px4.launch file<a class="hash-link" href="#8-run-px4launch-file" title="Direct link to heading">#</a></h3><p>8.1. In <code>px4.launch</code> file, make sure <code>fcu_url</code> is modified as stated in step 5</p><p>8.2. Change <code>gcs_url</code> into &quot;udp://@ip_address&quot;  </p><blockquote><p>The IP address inserted is the IP address of the computer where QGroundControl will run on. Therefore, when <code>px4.launch</code> file runs, the QGroundControl will be automatically connected to the pixhawk.</p></blockquote><p>8.3. Run the following command in terminal</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ roslaunch mavros px4.launch</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># Can try the following line if encounter error </span></span><span class="token-line" style="color:#393A34"><span class="token plain"># DeviceError: serial: open: Permission denied</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo chmod a+rw /dev/ttyTHS0</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Compiled information can be found <a href="https://github.com/DiegoHerrera1890/Pixhawk-connected-to-Jetson-Tx2-devkit" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>When UART port <code>THS0</code> is used to connect to pixhawk, warnings keep showing up while <code>px4.launch</code> file is running. However, when USB port <code>USB0</code> is used, <code>px4.launch</code> file runs normally.</p></div></div><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="vicon"></a>Vicon<a class="hash-link" href="#vicon" title="Direct link to heading">#</a></h2><p>Check out <a href="https://tlab-uav.github.io/tech-details/docs/systems/vicon/" target="_blank" rel="noopener noreferrer">website</a> to setup vicon.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="camera"></a>Camera<a class="hash-link" href="#camera" title="Direct link to heading">#</a></h2><p><strong>1. Check CUDA version</strong></p><p>Jetson Xavier has CUDA 10.2 pre-installed by SDK Manager</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># insert the following lines in .bashrc</span></span><span class="token-line" style="color:#393A34"><span class="token plain">export PATH=/usr/local/cuda-10.2/bin${PATH:+:${PATH}}$</span></span><span class="token-line" style="color:#393A34"><span class="token plain">export LD_LIBRARY_PATH=/usr/local/cuda-10.2/lib64${LD_LIBRARY_PATH:+:${LD_LIBRA$</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># check CUDA version</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ nvcc  --version</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ apt policy cuda  # might have error </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>2. Download ZED SDK for Jetpack 4.4 3.3.3 (Jetson Nano, NX, TX2, Xavier, CUDA 10.2) from <a href="https://www.stereolabs.com/developers/release/" target="_blank" rel="noopener noreferrer">Stereolabs</a></strong></p><p><strong>3. Follow the <a href="https://www.stereolabs.com/docs/installation/linux/" target="_blank" rel="noopener noreferrer">instructions</a> to install ZED SDK</strong></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The SDK is located at <code>/usr/local/zed/tools</code></p></div></div><p><strong>4. Download <a href="https://www.stereolabs.com/docs/ros/" target="_blank" rel="noopener noreferrer">ZED ROS Wrapper</a></strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd ~/catkin_ws/src</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git clone https://github.com/stereolabs/zed-ros-wrapper.git</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd ../</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ rosdep install --from-paths src --ignore-src -r -y</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ catkin build -DCMAKE_BUILD_TYPE=Release</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ source ./devel/setup.bash</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>5. Open a terminal and use roslaunch to start the ZED node:</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># ZED Mini camera: </span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ roslaunch zed_wrapper zedm.launch</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>6. Download cv_bridge from <a href="https://github.com/ros-perception/vision_opencv" target="_blank" rel="noopener noreferrer">GitHub</a></strong></p><p><strong>7. Data display with Rviz</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ roslaunch zed_display_rviz display_zedm.launch</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ rosrun rqt_reconfigure rqt_reconfigure</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Reference  code used for <a href="https://zhuanlan.zhihu.com/p/56565582" target="_blank" rel="noopener noreferrer">cpp</a></p></div></div><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="vio"></a>VIO<a class="hash-link" href="#vio" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="coordinate-frames"></a>Coordinate Frames<a class="hash-link" href="#coordinate-frames" title="Direct link to heading">#</a></h3><p>Frame used in <strong>ZED Mini</strong>: </p><p><code>map</code> (NWU) -&gt; <code>odom</code> (NWU) -&gt; <code>base_link</code> (NWU)</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p><code>map</code> is the parent of <code>odom</code> and <code>odom</code> is the parent of <code>base_link</code>. The definition of a child frame is based on its parent frame. Both <code>map</code> and <code>odom</code> are world-fixed frame while <code>base_link</code> is attached to the mobile robot base.</p></div></div><p>Frame conventions (odom) in <strong>ROS</strong>: </p><ul><li>Body frame: NWU</li><li>World frame: ENU</li></ul><p>Frame used in <strong>PX4</strong>: NED</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p><strong>Reading</strong></p><ol><li><a href="https://www.ros.org/reps/rep-0103.html" target="_blank" rel="noopener noreferrer">REP 103</a></li><li><a href="https://www.ros.org/reps/rep-0105.html" target="_blank" rel="noopener noreferrer">REP 105</a></li></ol></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="working-principle"></a>Working principle<a class="hash-link" href="#working-principle" title="Direct link to heading">#</a></h3><p>Feed <code>/mavros/odometry/out</code> with <code>odom</code> data of type <code>nav_msgs::Odometry</code> in the correct frame according to ROS conventions. Then, the functions in <code>odom.cpp</code> will transform the frame of <code>odom</code> data into the frame for MAVLINK (PX4). MAVLINK will fuse the <code>odom</code> data from <code>/mavros/odometry/out</code> with internal sensors using <code>EKF</code>. Eventually, the final position that is used by the flight controller will be published at <code>/mavros/local_position/pose</code>.</p><p><strong>About MAVROS</strong></p><p><strong>odom.cpp</strong></p><ul><li><p>odom_cb() : transforming and sending odometry to fcu</p></li><li><p>handle_odom() : receiving and transforming odometry from fcu</p><p><code>Frame_id</code> required by fcu</p></li><li><p>header.frame_id = &quot;odom_ned&quot;</p></li><li><p>child_frame_id = &quot;base_link_frd&quot;</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="steps"></a>Steps<a class="hash-link" href="#steps" title="Direct link to heading">#</a></h3><p>With <code>zed-ros-wrapper</code> and <code>mavros</code> running, open <code>rviz</code> to check the frames orientation and open <code>rqt</code> to check tf_tree.</p><p><img src="/tech-details/assets/images/YJ5-443282a000de291279ca16d66f772ed0.jpg"></p><p>Since the frames of <code>map</code> and <code>odom</code> in <code>zed-ros-wrapper</code> do <strong><em>not</em></strong> follow the ROS conventions, the transform by MAVROS from  <code>odom</code> to <code>odom_ned</code> is incorrect because it assumes the provided odom data is in ENU (but actually is NWU by ZED). Therefore, changes are needed to be made in code that performs frame transformation. </p><p>In <code>mavros/mavros/src/lib/uas_data.cpp</code>, line 54-68:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">std::vector&lt;geometry_msgs::TransformStamped&gt; transform_vector;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># from ENU to NED</span></span><span class="token-line" style="color:#393A34"><span class="token plain">add_static_transform(&quot;map&quot;, &quot;map_ned&quot;, Eigen::Affine3d(ftf::quaternion_from_rpy(M_PI, 0, M_PI_2)),transform_vector);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># from ENU to NED</span></span><span class="token-line" style="color:#393A34"><span class="token plain">add_static_transform(&quot;odom&quot;, &quot;odom_ned&quot;, Eigen::Affine3d(ftf::quaternion_from_rpy(M_PI, 0, M_PI_2)),transform_vector);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># from NWU to NED</span></span><span class="token-line" style="color:#393A34"><span class="token plain">add_static_transform(&quot;base_link&quot;, &quot;base_link_frd&quot;, Eigen::Affine3d(ftf::quaternion_from_rpy(M_PI, 0, 0)),transform_vector);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In order to match it with ZED frame settings, the following line has to be modified as shown.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># from NWU to NED</span></span><span class="token-line" style="color:#393A34"><span class="token plain">add_static_transform(&quot;odom&quot;, &quot;odom_ned&quot;, Eigen::Affine3d(ftf::quaternion_from_rpy(M_PI, 0, 0)),transform_vector);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># Modify &quot;map&quot; frame tranformation line if &quot;map_ned&quot; is used.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># The sequence is in (roll, pitch, yaw)</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># M_PI = 180 degree</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now check the orientation of <code>odom_ned</code> on Rviz. </p><p>Then, add the following lines in MAVROS launch file to feed the zed camera <code>odom</code> data to <code>/mavros/odometry/out</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!-- You should only remap either vision_pose or odometry, but not both --&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!-- /mavros/vision_pose/pose is posestamped, where /mavros/vision_pose/pose is posewithcovariancestamped --&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;remap from=&quot;/mavros/odometry/out&quot; to=&quot;/zedm/zed_node/odom&quot; /&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Add <code>estimator_type: 3</code> under <em>odometry</em> in <code>px4_config.yaml</code>.</p><p>Run <code>roscore</code>, <code>mavros</code> and <code>zed-ros-wrapper</code>. Note that <code>zed-ros-wrapper</code> has to be launched <strong><em>after</em></strong> messages <em>Time offset between FCU and OBC has been initialised</em> show on the terminal.</p><p>On QGC, set parameter <code>MAV_ODOM_LP</code> = 1 to loop back odometry. Then, check <code>ODOMETRY</code> at Mavlink Inspector. To verify the frame, perform the following actions. If all are true, it indicates that the frame is transformed correctly.</p><ul><li>Yaw clockwise: Quaternion[3] becomes positive/increases</li><li>Roll to the right: Quaternion[1] becomes positive/increases</li><li>Pitch up: Quaternion[2] becomes positive/increases</li><li>At initial position: The values of quaternion should be close to [1, 0, 0, 0] = [w, x, y, z]</li></ul><p>The second problem with <code>zed-ros-wrapper</code> is <strong><em>time synronisation</em></strong> between OBC and FCU. The time difference between FCU and OBC is too large. Therefore, <code>zed-ros-wrapper</code> is modified as following.</p><p>In <code>zed-ros-wrapper/zed_nodelets/src/zed_nodelet/src/zed_wrapper_nodelet.cpp</code>, add the following function in public.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// Huimin&#x27;s </span></span><span class="token-line" style="color:#393A34"><span class="token plain">uint64_t get_monotonic_now(void)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct timespec spec;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    clock_gettime(CLOCK_MONOTONIC, &amp;spec);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return spec.tv_sec * 1000000000ULL + spec.tv_nsec;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then, modify the code accordingly.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># line 3230-3240</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># Original code:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// Timestamp</span></span><span class="token-line" style="color:#393A34"><span class="token plain">if (mSvoMode) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    mFrameTimestamp = ros::Time::now();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    mFrameTimestamp = sl_tools::slTime2Ros(mZed.getTimestamp(sl::TIME_REFERENCE::IMAGE));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># Modified code:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// Timestamp</span></span><span class="token-line" style="color:#393A34"><span class="token plain">if (mSvoMode) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    mFrameTimestamp = ros::Time::now();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    NODELET_INFO_STREAM(&quot;In SVO mode&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint64_t monotonic_time = get_monotonic_now();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    mFrameTimestamp = ros::Time().fromNSec(monotonic_time); </span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># Note: publishOdom(mOdom2BaseTransf, mLastZedPose, mFrameTimestamp);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After catkin build, everything should be working fine. To further optimise VIO, fill the QRC parameter <code>EKF2_EV_DELAY</code> with the delay time (in milliseconds) between Vision and IMU by checking the Log file using FlightPlot.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="camera-calibration"></a>Camera Calibration<a class="hash-link" href="#camera-calibration" title="Direct link to heading">#</a></h2><ol><li>Install dependencies and Kalibr package</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo apt-get install python-setuptools python-rosinstall ipython libeigen3-dev libboost-all-dev doxygen libopencv-dev python-software-properties software-properties-common libpoco-dev python-matplotlib python-scipy python-git python-pip ipython libtbb-dev libblas-dev liblapack-dev python-catkin-tools libv4l-dev</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="2"><li>Record the data which will be used for calibration later</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ rosbag record -O Kalibr_data.bag /zedm/zed_node/imu/data_raw /zedm/zed_node/left/image_rect_color /zedm/zed_node/right/image_rect_color</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="3"><li><p>Add <code>april_gridl.yaml</code> and <code>imu-params.yaml</code> in the folder</p></li><li><p>Run calibratin file</p></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ kalibr_calibrate_cameras --bag /home/safmc/zed-kalibr/Kalibr_data.bag --topics /zedm/zed_node/left/image_rect_color /zedm/zed_node/right/image_rect_color --models pinhole-radtan pinhole-radtan --target /home/safmc/kalibr_workspace/src/kalibr/april_grid.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kalibr_calibrate_imu_camera --bag /home/safmc/zed-kalibr/Kalibr_data.bag --cam camchain-homesafmczed-kalibrKalibr_data.yaml --imu /home/safmc/kalibr_workspace/src/kalibr/imu-params.yaml --target /home/safmc/kalibr_workspace/src/kalibr/april_grid.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"># enter full path of Kalibr_data.bag and april_grid.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="teraranger-evo-60m"></a>Teraranger Evo 60m<a class="hash-link" href="#teraranger-evo-60m" title="Direct link to heading">#</a></h2><ol><li><p>Connect the sensor to pixhawk autopilot
<a href="https://www.terabee.com/connection-to-pixhawk-autopilots-teraranger-evo/" target="_blank" rel="noopener noreferrer">https://www.terabee.com/connection-to-pixhawk-autopilots-teraranger-evo/</a></p></li><li><p>Enable the parameter SENS_EN_TRANGER in QGC (Parameters-&gt;sensors)</p></li></ol><blockquote><p>If SENS_EN_TRANGER cannot be found, follow the steps below:</p><ol><li><p>Insert <code>distance_sensor/teraranger </code>
under <code>DRIVERS</code> in <code>Firmware/boards/px4/fmu-v2/default.cmake</code> file.</p></li><li><p>Type <code>make px4_fmu-v2</code> under <code>Firmware</code> directory in terminal.</p></li><li><p>Flash the firmware file(<code>Firmware/build/px4_fmu-v2_default/px4_fmu-v2_Default.px4</code>) to the board via QGC.</p></li><li><p>Now SENS_EN_TRANGER is visible in the parameters menu.</p></li></ol></blockquote><ol start="3"><li><p>Remove distance_sensor from blacklist in <code>~/catkin_ws/src/mavros/mavros/launch/px4_pluginlists.yaml</code>.</p></li><li><p>Modify px4_config.yaml to configure the sensor.</p><blockquote><p>Check that <code>id</code> under publisher is the same as the value found in QGC for <code>DISTANCE_SENSOR</code>.</p></blockquote></li><li><p>Type this command to check /mavros/distance_sensor/NAME_OF_THE_PUB is running.</p></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ rostopic list</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="6"><li>Type this command to view the readings of the sensor.</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ rostopic echo /mavros/distance_sensor/NAME_OF_THE_PUB</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="github"></a>GitHub<a class="hash-link" href="#github" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"># Push commits</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git add .</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git commit -m &quot;description&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git push origin master</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="remote-desktop"></a>Remote desktop<a class="hash-link" href="#remote-desktop" title="Direct link to heading">#</a></h2><p>FYI:
Local host is the current host in which you are logged in.
Remote host is the host to which you are trying to connect from the local host .</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="access-ubuntu-remotely-from-ubuntu"></a>Access Ubuntu remotely from Ubuntu<a class="hash-link" href="#access-ubuntu-remotely-from-ubuntu" title="Direct link to heading">#</a></h3><ul><li>SSH</li></ul><ol><li>Make sure both local host and remote host is connected to the same network </li><li>On local host, run the following command in terminal</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh desktop_name@ip_address_of_remote_host</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh yt@192.168.1.124  #example</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="3"><li>Enter <em>exit</em> to end SSH session</li></ol><ul><li>VNC</li></ul><ol><li>Make sure <em>Remmina</em> is installed in both host</li><li>Make sure both local host and remote host is connected to the same network </li><li>On remote host, open the Settings, under Sharing, turn on both screen sharing and remote login</li><li>Open Remmina, select VNC and enter the IP address of remote host </li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="access-ubuntu-remotely-from-macos"></a>Access Ubuntu remotely from Macos<a class="hash-link" href="#access-ubuntu-remotely-from-macos" title="Direct link to heading">#</a></h3><ul><li>VNC</li></ul><ol><li>Make sure both local host and remote host is connected to the same network </li><li>Finder &gt; Go &gt; Connect to server &gt; Browse &gt; Select &gt; Share screen (at top right of the window)</li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"></div><div class="col lastUpdated_3DPF">Last updated on <b><time datetime="2021-10-26T08:40:59.000Z">10/26/2021</time></b></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#platform" class="table-of-contents__link">Platform</a></li><li><a href="#qgroundcontrol" class="table-of-contents__link">QGroundControl</a><ul><li><a href="#tuning" class="table-of-contents__link"><strong>Tuning</strong></a></li><li><a href="#step-1-preparation" class="table-of-contents__link"><strong>Step 1: Preparation</strong></a></li><li><a href="#step-2-stabilize-roll-and-pitch-rates" class="table-of-contents__link"><strong>Step 2: Stabilize Roll and Pitch Rates</strong></a></li><li><a href="#step-3-stabilize-roll-and-pitch-angles" class="table-of-contents__link"><strong>Step 3: Stabilize Roll and Pitch Angles</strong></a></li><li><a href="#step-4-stabilize-yaw-rate" class="table-of-contents__link"><strong>Step 4: Stabilize Yaw Rate</strong></a></li><li><a href="#step-5-stabilize-yaw-angle" class="table-of-contents__link"><strong>Step 5: Stabilize Yaw Angle</strong></a></li></ul></li><li><a href="#pixhawk" class="table-of-contents__link">Pixhawk</a></li><li><a href="#nvidia-jetson-xavier-nx" class="table-of-contents__link">Nvidia Jetson Xavier NX</a><ul><li><a href="#1-set-up-jetson-xavier-nx-developer-kit" class="table-of-contents__link">1. Set up Jetson Xavier NX Developer Kit</a></li><li><a href="#2-install-software-with-sdk-manager" class="table-of-contents__link">2. Install software with SDK Manager</a></li><li><a href="#3-install-ros-melodic" class="table-of-contents__link">3. Install ROS Melodic</a></li><li><a href="#4-follow-the-source-installation-instructions-at-dronecode-to-compile-mavros" class="table-of-contents__link">4. Follow the <em>source installation instructions</em> at DroneCode to compile MAVROS</a></li><li><a href="#5-check-serial-port-txrx-using-loopback-test" class="table-of-contents__link">5. Check serial port (TX/RX) using loopback test</a></li><li><a href="#6-modify-the-line-shown-below-in-px4launch-file" class="table-of-contents__link">6. Modify the line shown below in <code>px4.launch</code> file</a></li><li><a href="#7-check-the-connection-between-px4-and-jetson-xavier" class="table-of-contents__link">7. Check the connection between PX4 and Jetson Xavier</a></li><li><a href="#8-run-px4launch-file" class="table-of-contents__link">8. Run px4.launch file</a></li></ul></li><li><a href="#vicon" class="table-of-contents__link">Vicon</a></li><li><a href="#camera" class="table-of-contents__link">Camera</a></li><li><a href="#vio" class="table-of-contents__link">VIO</a><ul><li><a href="#coordinate-frames" class="table-of-contents__link">Coordinate Frames</a></li><li><a href="#working-principle" class="table-of-contents__link">Working principle</a></li><li><a href="#steps" class="table-of-contents__link">Steps</a></li></ul></li><li><a href="#camera-calibration" class="table-of-contents__link">Camera Calibration</a></li><li><a href="#teraranger-evo-60m" class="table-of-contents__link">Teraranger Evo 60m</a></li><li><a href="#github" class="table-of-contents__link">GitHub</a></li><li><a href="#remote-desktop" class="table-of-contents__link">Remote desktop</a><ul><li><a href="#access-ubuntu-remotely-from-ubuntu" class="table-of-contents__link">Access Ubuntu remotely from Ubuntu</a></li><li><a href="#access-ubuntu-remotely-from-macos" class="table-of-contents__link">Access Ubuntu remotely from Macos</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/tech-details/docs/doc1/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/tech-details/docs/doc2/">Second Doc</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/tech-details/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/tlab-uav/tech-details" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 TSL. Built with Docusaurus.</div></div></div></footer></div>
<script src="/tech-details/assets/js/runtime~main.a0b825b1.js"></script>
<script src="/tech-details/assets/js/main.7a91feed.js"></script>
</body>
</html>