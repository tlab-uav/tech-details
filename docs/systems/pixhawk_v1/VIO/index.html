<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/tech-details/blog/rss.xml" title="117411 TSL UAV Tech Details Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/tech-details/blog/atom.xml" title="117411 TSL UAV Tech Details Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous"><title data-react-helmet="true">Visual-Inertial Odometry | 117411 TSL UAV Tech Details</title><meta data-react-helmet="true" property="og:url" content="https://tlab-uav.github.io//tech-details/docs/systems/pixhawk_v1/VIO/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Visual-Inertial Odometry | 117411 TSL UAV Tech Details"><meta data-react-helmet="true" name="description" content="packagename: ekfsensor_fusion"><meta data-react-helmet="true" property="og:description" content="packagename: ekfsensor_fusion"><link data-react-helmet="true" rel="shortcut icon" href="/tech-details/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://tlab-uav.github.io//tech-details/docs/systems/pixhawk_v1/VIO/"><link data-react-helmet="true" rel="alternate" href="https://tlab-uav.github.io//tech-details/docs/systems/pixhawk_v1/VIO/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://tlab-uav.github.io//tech-details/docs/systems/pixhawk_v1/VIO/" hreflang="x-default"><link rel="stylesheet" href="/tech-details/assets/css/styles.032a5ccc.css">
<link rel="preload" href="/tech-details/assets/js/runtime~main.750cdc36.js" as="script">
<link rel="preload" href="/tech-details/assets/js/main.5acc3c5f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/tech-details/"><img src="/tech-details/img/android-chrome-192x192.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/tech-details/img/android-chrome-192x192.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">TSL Tech Details</b></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/tech-details/docs/hardware/jetson-tx2/flash-existing-image/">Hardware</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/hardware/jetson-tx2/flash-existing-image/">Jetson TX2</a></li><li><a class="dropdown__link" href="/tech-details/docs/hardware/jetson-xavier-nx/getting-started/">Jetson Xavier NX</a></li><li><a class="dropdown__link" href="/tech-details/docs/hardware/cameras/tiscamera-install/">Cameras</a></li><li><a class="dropdown__link" href="/tech-details/docs/hardware/px4-firmware/px4-overview/">PX4 Firmware</a></li><li><a class="dropdown__link" href="/tech-details/docs/hardware/UAV-Platform/Multirotor-overview/">UAV Platform</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/tech-details/docs/systems/vicon/">Systems</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/systems/ros-coordinate-systems/">ROS Coordinate Systems</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/unity-simulator/">Simulations</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/vicon/">Vicon</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/pixhawk/getting-started/">Pixhawk Platform</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/pixhawk_v1/pixhawk/">Past Platforms : pixhawk v1</a></li><li><a class="dropdown__link" href="/tech-details/docs/systems/SAFMC/">SAFMC Drone Buildup</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/tech-details/docs/linux/getting-started/gnome-shell-extensions/">Linux</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/linux/getting-started/overview/">Getting Started</a></li><li><a class="dropdown__link" href="/tech-details/docs/linux/packages/file-systems/">Software Packages</a></li><li><a class="dropdown__link" href="/tech-details/docs/linux/ros/using-catkin-build/">ROS</a></li><li><a class="dropdown__link" href="/tech-details/docs/linux/kernel/grub-default-kernel/">Drivers &amp; Kernel</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/tech-details/docs/productivity/git/git/">Productivity</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/productivity/git/git/">Git Version Control</a></li><li><a class="dropdown__link" href="/tech-details/docs/productivity/cmake_debug/cmake/">CMake and Debugging</a></li><li><a class="dropdown__link" href="/tech-details/docs/productivity/uiux/pangolin/">UI/UX Tools</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/tech-details/docs/research/flight-data/flight-data-analysis/">Research</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/tech-details/docs/research/flight-data/flight-data-analysis/">Flight Data</a></li><li><a class="dropdown__link" href="/tech-details/docs/research/calibration/getting-started/">Sensor Calibration</a></li><li><a class="dropdown__link" href="/tech-details/docs/research/collision-avoidance/overview-problems/">Collision Avoidance</a></li><li><a class="dropdown__link" href="/tech-details/docs/research/vio/basalt-overview/">VIO</a></li><li><a class="dropdown__link" href="/tech-details/docs/research/edt/edt-overview/">EDT</a></li></ul></div><a class="navbar__item navbar__link" href="/tech-details/docs/examples/doc0/">Examples (To Edit)</a><a class="navbar__item navbar__link" href="/tech-details/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tlab-uav/tech-details" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/tech-details/"><img src="/tech-details/img/android-chrome-192x192.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/tech-details/img/android-chrome-192x192.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">TSL Tech Details</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/tech-details/docs/hardware/jetson-tx2/flash-existing-image/">Hardware</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/jetson-tx2/flash-existing-image/">Jetson TX2</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/jetson-xavier-nx/getting-started/">Jetson Xavier NX</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/cameras/tiscamera-install/">Cameras</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/px4-firmware/px4-overview/">PX4 Firmware</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/hardware/UAV-Platform/Multirotor-overview/">UAV Platform</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a aria-current="page" class="menu__link menu__link--sublist navbar__link--active" role="button" href="/tech-details/docs/systems/vicon/">Systems</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/ros-coordinate-systems/">ROS Coordinate Systems</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/unity-simulator/">Simulations</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/vicon/">Vicon</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/pixhawk/getting-started/">Pixhawk Platform</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/pixhawk_v1/pixhawk/">Past Platforms : pixhawk v1</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/systems/SAFMC/">SAFMC Drone Buildup</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/tech-details/docs/linux/getting-started/gnome-shell-extensions/">Linux</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/linux/getting-started/overview/">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/linux/packages/file-systems/">Software Packages</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/linux/ros/using-catkin-build/">ROS</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/linux/kernel/grub-default-kernel/">Drivers &amp; Kernel</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/tech-details/docs/productivity/git/git/">Productivity</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/productivity/git/git/">Git Version Control</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/productivity/cmake_debug/cmake/">CMake and Debugging</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/productivity/uiux/pangolin/">UI/UX Tools</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/tech-details/docs/research/flight-data/flight-data-analysis/">Research</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/flight-data/flight-data-analysis/">Flight Data</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/calibration/getting-started/">Sensor Calibration</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/collision-avoidance/overview-problems/">Collision Avoidance</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/vio/basalt-overview/">VIO</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/research/edt/edt-overview/">EDT</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/docs/examples/doc0/">Examples (To Edit)</a></li><li class="menu__list-item"><a class="menu__link" href="/tech-details/blog/">Blog</a></li><li class="menu__list-item"><a href="https://github.com/tlab-uav/tech-details" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">General</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/systems/ros-coordinate-systems/">ROS Coordinate Systems</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Simulations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/systems/unity-simulator/">Unity Simulator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/systems/unity-setup/">Unity Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/systems/unity-buildyourown/">Build-your-own</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/systems/unity-SITL/">Unity SITL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/systems/unity-HITL/">Unity HITL</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Vicon</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/systems/vicon/">Vicon Setup</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">SAFMC Drone Build</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/systems/SAFMC/">Building SAFMC Drone</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Auto Fast Flt Platform</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/tech-details/docs/systems/pixhawk/getting-started/">Getting Started</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Past Platforms : pixhawk v2</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tech-details/docs/systems/pixhawk_v1/pixhawk/">pixhawk Project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tech-details/docs/systems/pixhawk_v1/getting-started/">Getting Started</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/tech-details/docs/systems/pixhawk_v1/VIO/">Visual-Inertial Odometry</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tech-details/docs/systems/pixhawk_v1/motion-planning/">Motion Planning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tech-details/docs/systems/pixhawk_v1/tracking-and-detection/">Tracking and Detection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tech-details/docs/systems/pixhawk_v1/simulator/">Simulator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/tech-details/docs/systems/pixhawk_v1/web-ui/">Web-based UI</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">Visual-Inertial Odometry</h1></header><blockquote><p>package_name: ekf_sensor_fusion</p><p>launch_file_location: ssf_updates/launch/visionpose_sensor_pixhawk.launch</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="system-overview"></a>System Overview<a class="hash-link" href="#system-overview" title="Direct link to heading">#</a></h2><p>The <code>ekf_sensor_fusion</code> package performs loose-coupled sensor fusion from stereo camera&#x27;s visual odometry and IMU&#x27;s inertial measurement to produce UAV pose estimation.</p><p>The filter is formulated to take in body-frame velocity measurement from the visual odometry module (ZED camera), instead of the pose measurement with respect to the initial body-frame.</p><p>This architecture allows temporal VO measurement errors to be rejected effectively, when an inconsistency between IMU integration and VO measurement is detected.</p><table><thead><tr><th align="center"><img alt="pixhawk Coordinate System" src="/tech-details/assets/images/pixhawk_coordinate_systems-fa23aa5bdeb709ea285775e17627d7eb.png"></th><th align="center"><img alt="State Estimation" src="/tech-details/assets/images/state_estimation_overview-ff9a6dce682b43a968629fec13e73fad.png"></th></tr></thead><tbody><tr><td align="center">pixhawk Coordinate System</td><td align="center">State Estimation Diagram</td></tr></tbody></table><p>The output of this module is the pose estimation, and only the X-Y coordinates of the pose information is fed to Pixhawk&#x27;s internal state filter.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="inputs-and-outputs"></a>Inputs and Outputs<a class="hash-link" href="#inputs-and-outputs" title="Direct link to heading">#</a></h2><p>Inputs:</p><table><thead><tr><th>Description</th><th>ROS Topic Type</th><th>ROS Topics (remapped in .launch files)</th><th>Recommended Frequency</th></tr></thead><tbody><tr><td>IMU Input (accel + gyro)</td><td>sensor_msgs/Imu</td><td>ekf_fusion/imu_state_input</td><td>&gt;= 100Hz</td></tr><tr><td>Magnetometer Input</td><td>sensor_msgs/MagneticField</td><td>ekf_fusion/mag_state_input</td><td>same as IMU</td></tr><tr><td>Velocity Odometry</td><td>geometry_msgs/PoseStamped</td><td>ekf_fusion/visionpose_measurement</td><td>&gt;= 15Hz</td></tr><tr><td>Delta-Pose Odometry</td><td>geometry_msgs/PoseStamped</td><td>ekf_fusion/zedpose_measurement</td><td>not tested</td></tr></tbody></table><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Time Synchronisation of Inputs</h5></div><div class="admonition-content"><p>Input ROS messages are time-synchronised internally, to the messages&#x27; header stamp. Therefore, it is important to ensure the timestamp of the inputs are sufficiently accurate.</p></div></div><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Best Practices</h5></div><div class="admonition-content"><ul><li>IMU sensor has drift over time, even between each power cycle. Therefore, pixhawk&#x27;s Pixhawk firmware is programmed to perform gyro calibration at power on. DO NOT move the UAV for the first 20 second or so, until the second boot up success beeping sound is heard (indicating completion of gyro calibration).</li><li>Magnetometer has significant drift indoor and it almost always requires re-calibration in new environments.<ul><li>Therefore, magnetometer input is only used during the filter initialisation, and essentially ignored when the UAV is flying. (by giving large variance in <code>meas_noise2</code> parameter)</li></ul></li><li>Delta-Pose Odometry should not be used in general, as it is not tested. (keep <code>velocity_measurement</code> as true)</li></ul></div></div><p>Outputs:</p><table><thead><tr><th>Description</th><th>ROS Topic Type</th><th>ROS Topics</th></tr></thead><tbody><tr><td>IMU-rate pose output in world <code>ekf_frame</code>  (default NWU)</td><td>geometry_msgs/PoseWithCovarianceStamped</td><td>/ekf_fusion/pose</td></tr><tr><td>IMU-rate pose output, same as above but yaw is with respect to initial heading, instead of magnetic north</td><td>geometry_msgs/PoseWithCovarianceStamped</td><td>/ekf_fusion/pose_local</td></tr><tr><td>The same as <code>/ekf_fusion/pose</code> but at VO-rate</td><td>geometry_msgs/PoseWithCovarianceStamped</td><td>/ekf_fusion/pose_corrected</td></tr><tr><td>FOR DEBUG ONLY (Integrated pose from IMU inputs only)</td><td>geometry_msgs/PoseWithCovarianceStamped</td><td>/ekf_fusino/pose_integrated</td></tr></tbody></table><p>Generally, Pixhawk prefers to take in pose estimation with respected to magnetic north, at highest frequency possible, therefore <code>/ekf_fusion/pose</code> is currently used.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="initialisation"></a>Initialisation<a class="hash-link" href="#initialisation" title="Direct link to heading">#</a></h2><p>Prior to the start of the system, the UAV should be in a stationary state,</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="configurable-parameters-yaml"></a>Configurable Parameters (.yaml)<a class="hash-link" href="#configurable-parameters-yaml" title="Direct link to heading">#</a></h3><table><thead><tr><th>Parameters</th><th>Description</th><th>Recommended Values</th></tr></thead><tbody><tr><td>velocity_measurement</td><td>Always set true, as the filter is designed and tested to receive velocity measurement</td><td>true</td></tr><tr><td>pose_of_camera_not_imu</td><td>Set if the pose estimation is for camera-body or imu-body</td><td>false</td></tr><tr><td>use_imu_internal_q</td><td>If IMU has internal estimation of attitude, this could be set to true. Otherwise, the initial pose would be estimated from accelerometer (gravity-align) and magnetometer (north-align)</td><td>true</td></tr><tr><td>do_init_gyro_bias_estimate</td><td>When set true, the filter assumes the UAV is absolutely stationary, and all the finite gyro readings are fed as gyro bias in the states</td><td>true</td></tr><tr><td>imu_frame</td><td>The coordinate frame that IMU input is using</td><td>NWU</td></tr><tr><td>ekf_frame</td><td>The coordinate frame that the filter pose output is using</td><td>NWU</td></tr><tr><td>sigma_distance_scale</td><td>This parameter set how tolerant the filter is towards deviation of VO measured velocity / rotation agains IMU&#x27;s integrated value. Smaller the value, the more sensitive the rejection</td><td>3</td></tr><tr><td>scale_init</td><td>Stereo&#x27;s visual frame scale respect to world frame. This value could be obtained from real-world test of the stereo camera</td><td>1.0</td></tr><tr><td>fixed_scale</td><td>Fix visual frame scale</td><td>true</td></tr><tr><td>fixed_bias</td><td>Set whether IMU bias online estimation is disabled</td><td>false</td></tr><tr><td>fixed_calib</td><td>Set whether Camera-IMU calibration estimation is disabled</td><td>false</td></tr><tr><td>noise_acc</td><td>Noise of accelerometer measurement</td><td>0.01</td></tr><tr><td>noise_accbias</td><td>Drift rate of accelerometer measurement</td><td>0.0004</td></tr><tr><td>noise_gyr</td><td>Noise of gyroscope measurement (much smaller than accel)</td><td>0.008</td></tr><tr><td>noise_gyrbias</td><td>Drift rate of gyroscope</td><td>0.00002</td></tr><tr><td>noise_scale</td><td>Not used</td><td>0.0</td></tr><tr><td>noise_qwv</td><td>Not used</td><td>0.0</td></tr><tr><td>noise_qci</td><td>Not used</td><td>0.0</td></tr><tr><td>noise_pic</td><td>Not used</td><td>0.0</td></tr><tr><td>delay</td><td>How much time in second VO is lagging IMU timestamps</td><td>0.0</td></tr><tr><td><strong>meas_noise1</strong></td><td>Noise of velocity measurement. The noise should be smaller when frequency increases</td><td>0.03 for 15Hz;<br>0.008 for 30Hz</td></tr><tr><td><strong>meas_noise2</strong></td><td>Noise of IMU quaternion measurement</td><td>9999</td></tr><tr><td>init/q_ci</td><td>attitude of camera with respect to IMU</td><td>-</td></tr><tr><td>init/p_ci</td><td>position of camera with respect to IMU</td><td>-</td></tr><tr><td>init/q_ib</td><td>mounting position of IMU with respect to UAV</td><td>-</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="initialisation-failures"></a>Initialisation Failures<a class="hash-link" href="#initialisation-failures" title="Direct link to heading">#</a></h3><p>The filter implemented a relatively robust initialisation check, so it is not uncommon to encounter the situation where the filter refuses to initialise. Most of the failures are reported as ROS messages to give clue for debugging.</p><p>For the convenience, common failures are listed below:</p><p><strong>IMU input failed to be received</strong></p><ul><li><strong>Symptom</strong>: &quot;Waiting for IMU inputs...&quot;</li><li><strong>Possible causes</strong>: Pixhawk / mavros failure, check system_id etc.</li></ul><p><strong>Some IMU input received, but not all</strong> (failed to synchronise IMU / magnetometer)</p><ul><li><strong>Symptom</strong>: &quot;[ssf_core] Low number of synchronized imu/magnetometer tuples received.&quot;</li><li><strong>Possible causes</strong>: Magnetometer not connected properly</li></ul><p><strong>IMU inputs are received in sync, but IMU Variance Test cannot pass</strong></p><ul><li><strong>Symptom</strong>: Keep receiving &quot;=============IMU Variance Statitics==============&quot; message</li><li><strong>Possible causes</strong>: <ul><li>IMU Gravity estimate deviate too much from reference</li><li>Variance of accel, gyro, or magnetometer is too large over the measurement window.</li></ul></li></ul><p><strong>IMU input data received, but no VO measurement</strong></p><ul><li><strong>Symptom</strong>: <code>ekf_fusion/pose</code> keep drifting, and <code>ekf_fusion/pose_local</code> is not publishing</li><li><strong>Possible causes</strong>: ZED camera does not start correctly, check USB connection etc</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="zed-stereo-camera-calibration"></a>ZED Stereo Camera Calibration<a class="hash-link" href="#zed-stereo-camera-calibration" title="Direct link to heading">#</a></h2><p>During our flight test, we confirmed that ZED stock calibration is not accurate, even with re-calibration using their official tools.</p><p>Therefore, calibration using a dedicate calibration tool like Kalibr is strongly recommended.</p><p>After the Kalibr calibration, modify the factory calibration provided by ZED company (could be obtained by SDK, or visit  <a href="http://calib.stereolabs.com/?SN=1010" target="_blank" rel="noopener noreferrer">http://calib.stereolabs.com/?SN=1010</a>) with the values of the Kalibr output. The modified file should be stored in <code>pixhawk_v1/param/zed/settings/SNxxxxx.conf</code></p><p>A sample calibration file could look like this (calibrated under VGA resolution)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly ini"><pre tabindex="0" class="prism-code language-ini codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">[LEFT_CAM_VGA]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">cx = 333.25292570048475</span></span><span class="token-line" style="color:#393A34"><span class="token plain">cy = 191.39765841045107</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fx = 340.7373436904007</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fy = 340.83066466998304</span></span><span class="token-line" style="color:#393A34"><span class="token plain">k1 = -0.17236577491455016</span></span><span class="token-line" style="color:#393A34"><span class="token plain">k2 = 0.025798283381817392</span></span><span class="token-line" style="color:#393A34"><span class="token plain">p1 = 0.0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">p2 = -0.00013</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[RIGHT_CAM_VGA]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">cx = 340.91855014058245</span></span><span class="token-line" style="color:#393A34"><span class="token plain">cy = 184.2264715537507</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fx = 340.8878322679929</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fy = 340.89265557837626</span></span><span class="token-line" style="color:#393A34"><span class="token plain">k1 = -0.17317038234955687</span></span><span class="token-line" style="color:#393A34"><span class="token plain">k2 = 0.026135241148153184</span></span><span class="token-line" style="color:#393A34"><span class="token plain">p1 = -0.00026</span></span><span class="token-line" style="color:#393A34"><span class="token plain">p2 = -0.0005221063830678553</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[STEREO]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Baseline = 120.899</span></span><span class="token-line" style="color:#393A34"><span class="token plain">CV_2K = 0.00850606</span></span><span class="token-line" style="color:#393A34"><span class="token plain">CV_FHD = 0.00850606</span></span><span class="token-line" style="color:#393A34"><span class="token plain">CV_HD = 0.00850606</span></span><span class="token-line" style="color:#393A34"><span class="token plain">CV_VGA = 0.0032</span></span><span class="token-line" style="color:#393A34"><span class="token plain">RX_2K = -0.00420175</span></span><span class="token-line" style="color:#393A34"><span class="token plain">RX_FHD = -0.00420175</span></span><span class="token-line" style="color:#393A34"><span class="token plain">RX_HD = -0.00420175</span></span><span class="token-line" style="color:#393A34"><span class="token plain">RX_VGA = -0.0023</span></span><span class="token-line" style="color:#393A34"><span class="token plain">RZ_2K = -0.0014632</span></span><span class="token-line" style="color:#393A34"><span class="token plain">RZ_FHD = -0.0014632</span></span><span class="token-line" style="color:#393A34"><span class="token plain">RZ_HD = -0.0014632</span></span><span class="token-line" style="color:#393A34"><span class="token plain">RZ_VGA = -0.0006</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"></div><div class="col lastUpdated_3DPF">Last updated on <b><time datetime="2021-08-14T16:02:32.000Z">8/14/2021</time></b></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/tech-details/docs/systems/pixhawk_v1/getting-started/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Getting Started</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/tech-details/docs/systems/pixhawk_v1/motion-planning/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Motion Planning Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#system-overview" class="table-of-contents__link">System Overview</a></li><li><a href="#inputs-and-outputs" class="table-of-contents__link">Inputs and Outputs</a></li><li><a href="#initialisation" class="table-of-contents__link">Initialisation</a><ul><li><a href="#configurable-parameters-yaml" class="table-of-contents__link">Configurable Parameters (.yaml)</a></li><li><a href="#initialisation-failures" class="table-of-contents__link">Initialisation Failures</a></li></ul></li><li><a href="#zed-stereo-camera-calibration" class="table-of-contents__link">ZED Stereo Camera Calibration</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/tech-details/docs/doc1/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/tech-details/docs/doc2/">Second Doc</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/tech-details/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/tlab-uav/tech-details" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 TSL. Built with Docusaurus.</div></div></div></footer></div>
<script src="/tech-details/assets/js/runtime~main.750cdc36.js"></script>
<script src="/tech-details/assets/js/main.5acc3c5f.js"></script>
</body>
</html>